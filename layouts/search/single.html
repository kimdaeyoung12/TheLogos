{{ define "main" }}
<div class="relative min-h-screen flex flex-col pt-20 pb-12 px-6 max-w-[1280px] mx-auto z-10 w-full">
    <div class="flex flex-col items-center justify-center text-center gap-6 mb-12">
        <h1
            class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-design-primary to-purple-500">
            Search The Logos
        </h1>
        <p class="text-gray-600 dark:text-gray-400 max-w-xl">
            Find articles, topics, and insights across our collection.
        </p>

        <!-- Search Input -->
        <div class="w-full max-w-2xl relative">
            <input type="text" id="search-input"
                class="w-full px-5 py-4 rounded-xl bg-white dark:bg-design-card-dark border border-gray-200 dark:border-white/10 text-lg shadow-sm focus:ring-2 focus:ring-design-primary focus:border-transparent outline-none transition-all"
                placeholder="Type to search..." autofocus>
            <span
                class="material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">search</span>
        </div>
    </div>

    <!-- Search Results -->
    <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
        <!-- Results will be populated here via JS -->
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
<script>
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');

    // Get query param
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');

    // Initialize Fuse with Hugo index
    let fuse;

    async function initSearch() {
        try {
            const response = await fetch('/index.json');
            const data = await response.json();

            const options = {
                keys: ['title', 'content', 'description', 'categories'],
                threshold: 0.3,
                minMatchCharLength: 2,
                ignoreLocation: true
            };

            fuse = new Fuse(data, options);

            if (query) {
                searchInput.value = query;
                performSearch(query);
            }
        } catch (e) {
            console.error("Search index failed to load", e);
            searchResults.innerHTML = `<p class="text-center w-full col-span-full text-red-500">Search is currently unavailable.</p>`;
        }
    }

    function performSearch(term) {
        if (!term) {
            searchResults.innerHTML = '';
            return;
        }

        const results = fuse.search(term);

        if (results.length === 0) {
            searchResults.innerHTML = `<p class="text-center w-full col-span-full text-gray-500">No results found for "${term}"</p>`;
            return;
        }

        const html = results.map(result => {
            const item = result.item;
            return `
            <a href="${item.permalink}" class="group relative flex flex-col sm:flex-row bg-white dark:bg-design-card-dark rounded-xl overflow-hidden border border-gray-100 dark:border-white/5 hover:border-design-primary/30 transition-all hover:-translate-y-1 shadow-sm hover:shadow-md h-full">
                <!-- Text Content -->
                <div class="p-6 flex flex-col flex-1">
                    <div class="flex items-center gap-2 mb-3">
                         <span class="text-xs font-bold uppercase tracking-wider text-design-primary">${item.categories ? item.categories[0] : 'Article'}</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-design-primary transition-colors">${item.title}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-3 mb-4">${item.description || item.summary || ''}</p>
                    <div class="mt-auto flex items-center text-sm font-medium text-design-primary">
                        Read Article <span class="material-symbols-outlined text-sm ml-1">arrow_forward</span>
                    </div>
                </div>
            </a>
            `;
        }).join('');

        searchResults.innerHTML = html;
    }

    searchInput.addEventListener('input', (e) => {
        performSearch(e.target.value);
        // Update URL
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('q', e.target.value);
        window.history.pushState({}, '', newUrl);
    });

    initSearch();
</script>
{{ end }}